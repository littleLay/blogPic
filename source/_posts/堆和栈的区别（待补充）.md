---
title: 堆和栈的区别（待补充）
date: 2018/4/20
categories: 小Tips
---
![2018 忘了哪月哪日 应该是阴天](https://imgsa.baidu.com/forum/w%3D580%3B/sign=5d0ed35d1c3853438ccf8729a328b07e/d4628535e5dde711f8cb63c7abefce1b9d1661e1.jpg)

### <center> 堆和栈的区别？
<center> [资料原文](https://www.zhihu.com/question/19729973)

##### <center> 栈区（stack）——由编译器自动分配释放，存放函数的参数值、局部变量的值等，其操作方式类似于数据结构中的栈。
##### <center> 堆区（heap）——一般由程序员分配释放，若程序员不是放，程序结束时可能由OS回收。
<!-- more -->
<br>
#### <center>区别和联系：
##### - 申请方式：
堆：由程序员自己申请并指明大小，比如在c中malloc函数，如p1 = (char*)malloc(10);
栈：由系统自动分配，如声明在函数中一个局部变量int b;系统自动在栈中为b开辟空间。

##### - 申请后系统的响应
栈：只要栈的剩余空间大于所申请空间，系统将为程序提供内存，否则将报异常提示栈溢出。
堆：首先应该知道操作系统有一个记录空闲内存地址的链表，当系统收到程序的申请时，会遍历该链表，寻找第一个空间大于所申请空间的堆结点，然后将该结点从空闲结点链表中删除，并将该结点的空间分配给程序。另外，对于大多数系统，会在这块内存空间中的首地址处记录本次分配的大小，这样，代码中的delete语句才能正确的释放本地内存空间。另外，由于找到的堆结点的大小不一定正好等于申请的大小，系统会自动的将多余的那部分重新放入空闲链表中。

##### - 申请大小的限制
栈：在windows下，栈是向低地址扩展的数据结构，是一块连续的内存的区域。即栈顶的地址和栈的最大容量是系统预先规定好的，在windows下，栈的大小是iM（i<=2，是一个编译时就确定的常数），如果申请的空间超过栈的剩余空间时，将提示overflow，因此，能从栈获得的空间较小。
堆：堆是向高地址扩展的数据结构，是不连续的内存区域，这是由于系统是用链表来存储空闲内存地址的，自然是不连续的，而链表的遍历方向是由低地址向高地址。堆的大小受限于计算机系统中有效的虚拟内存，由此可见，堆获得的空间比较灵活，也比较大。

##### - 申请效率的比较
栈是由系统自动分配，速度较快，但程序员是无法控制的。
堆是由new分配的内存，一般速度比较慢，而且容易产生内存碎片，但是用起来最方便。
<br>
#### <center>总结：

##### <center> 使用栈就像我们去饭馆里吃饭，只管点菜、付钱和吃，吃饱了就走，不必理会切菜、洗菜等准备工作和洗碗、刷锅等扫尾工作，好处是快捷，但是自由度小
##### <center> 使用堆就像是自己动手做喜欢吃的菜肴，比较麻烦，但是比较符合自己的口味，并且自由度大。
<br>
